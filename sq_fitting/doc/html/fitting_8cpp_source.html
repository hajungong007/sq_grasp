<html><head><meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<title>sq_fitting: fitting.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_08946fb7f01e92820b9fd3a9f1d00ca1.html">sq_fitting</a></li><li class="navelem"><a class="el" href="dir_625ab29602b5525dac2e5b1f91fc8bf4.html">src</a></li><li class="navelem"><a class="el" href="dir_84a6be2bf69535691b9b955077166c10.html">sq_fitting</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">fitting.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="fitting_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="fitting_8h.html">sq_fitting/fitting.h</a>&gt;</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="preprocessor">#include &lt;pcl/features/moment_of_inertia_estimation.h&gt;</span></div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="preprocessor">#include &lt;unsupported/Eigen/NonLinearOptimization&gt;</span></div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;pcl/filters/statistical_outlier_removal.h&gt;</span></div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;pcl/filters/voxel_grid.h&gt;</span></div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &lt;pcl/common/pca.h&gt;</span></div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;Eigen/Eigenvalues&gt;</span></div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;Eigen/Eigen&gt;</span></div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;eigen_conversions/eigen_msg.h&gt;</span></div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &lt;tf_conversions/tf_eigen.h&gt;</span></div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &lt;tf/transform_listener.h&gt;</span></div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="classSuperquadricFitting.html#acdbb5c0fe1af3f8a2842352c2906fcb5">   16</a></span>&#160;<a class="code" href="classSuperquadricFitting.html#ac59690650a3dcc82611252df47515124">SuperquadricFitting::SuperquadricFitting</a>(<span class="keyword">const</span> pcl::PointCloud&lt;PointT&gt;::Ptr&amp; input_cloud) : pre_align_(true), pre_align_axis_(2)</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;{</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  <a class="code" href="classSuperquadricFitting.html#a62049cf3bf16b6c5c24c24d511ff989c">cloud_</a> = input_cloud;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  <a class="code" href="classSuperquadricFitting.html#ac119a5cf442fca0edcd613423e8e2a42">set_method_</a> = <span class="keyword">false</span>;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;}</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno"><a class="line" href="classSuperquadricFitting.html#a3a0199ef93abec4e871a076d4e715f09">   22</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classSuperquadricFitting.html#a3a0199ef93abec4e871a076d4e715f09">SuperquadricFitting::getMinParams</a>(sq_fitting::sq &amp;param)</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;{</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;  param = <a class="code" href="classSuperquadricFitting.html#aab1625fa8906cce96fbdcdd0850c1e07">params_</a>;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;}</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div><div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="classSuperquadricFitting.html#a18e5c50bfe3d9f4c439574f5c63de4b5">   27</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classSuperquadricFitting.html#a18e5c50bfe3d9f4c439574f5c63de4b5">SuperquadricFitting::getPreAlignedCloud</a>(pcl::PointCloud&lt;PointT&gt;::Ptr&amp; cloud)</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;{</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  cloud = <a class="code" href="classSuperquadricFitting.html#ac018436dbb2a9f98ac5c95a4d6cf7d81">prealigned_cloud_</a>;</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;}</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div><div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="classSuperquadricFitting.html#a05dc44535b7a27bea36c05e5a4bf4f2e">   32</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classSuperquadricFitting.html#a05dc44535b7a27bea36c05e5a4bf4f2e">SuperquadricFitting::setPreAlign</a>(<span class="keywordtype">bool</span> pre_align, <span class="keywordtype">int</span> pre_align_axis)</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;{</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="classSuperquadricFitting.html#ab77956da49f8efaf6a948ce6ea31ac1b">pre_align_</a> = pre_align;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  <a class="code" href="classSuperquadricFitting.html#abbf97679b0b186ca9306d4310a799905">pre_align_axis_</a> = pre_align_axis;</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;}</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno"><a class="line" href="classSuperquadricFitting.html#a6c217883515b40d053aff4406caaf2a1">   38</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classSuperquadricFitting.html#a6c217883515b40d053aff4406caaf2a1">SuperquadricFitting::preAlign</a>(Eigen::Affine3f &amp;transform, Eigen::Vector3f &amp;variances)</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;{</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSuperquadricFitting.html#ac119a5cf442fca0edcd613423e8e2a42">set_method_</a>)</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  {</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classSuperquadricFitting.html#ad186d372a3169deea700462d9470fecf">pose_est_method_</a>==<span class="stringliteral">&quot;iteration&quot;</span>)</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    {</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;        <span class="comment">//centroid::my method</span></div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      <span class="keywordtype">double</span> x, y, z;</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      <a class="code" href="utils_8h.html#aaac31e71435e34a72d1fcdeb1dfc4788">getCenter</a>(<a class="code" href="classSuperquadricFitting.html#a62049cf3bf16b6c5c24c24d511ff989c">cloud_</a>, x, y,z);</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      Eigen::Affine3f transformation_centroid = Eigen::Affine3f::Identity();</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      transformation_centroid.translation()&lt;&lt;-x, -y, -z;</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      <span class="comment">//Pose estimation</span></div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="comment">//my method</span></div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      geometry_msgs::Pose pose;</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <a class="code" href="utils_8h.html#ad778895dd75a8d0566e4dc38eec2f317">getTransformPose</a>(<a class="code" href="classSuperquadricFitting.html#a62049cf3bf16b6c5c24c24d511ff989c">cloud_</a>, pose);</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      pose.position.x = 0;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      pose.position.y = 0;</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      pose.position.z = 0;</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      Eigen::Affine3d transform_in_eigen;</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      tf::poseMsgToEigen(pose, transform_in_eigen);</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      Eigen::Affine3d transform_in_eigen_inv = transform_in_eigen.inverse();</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;      transform =  transform_in_eigen_inv.cast&lt;<span class="keywordtype">float</span>&gt;() * transformation_centroid ;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      Eigen::Vector3f eigenValues;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;      eigenValues&lt;&lt;0.25,0.25,0.25;</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      eigenValues /= <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(<a class="code" href="classSuperquadricFitting.html#a62049cf3bf16b6c5c24c24d511ff989c">cloud_</a>-&gt;size());</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;      variances(0) = sqrt(eigenValues(0));</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      variances(1) = sqrt(eigenValues(1));</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      variances(2) = sqrt(eigenValues(2));</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    }</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="classSuperquadricFitting.html#ad186d372a3169deea700462d9470fecf">pose_est_method_</a>==<span class="stringliteral">&quot;pca&quot;</span>)</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    {</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      Eigen::Vector4f xyz_centroid;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        pcl::compute3DCentroid(*<a class="code" href="classSuperquadricFitting.html#a62049cf3bf16b6c5c24c24d511ff989c">cloud_</a>, xyz_centroid);</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        Eigen::Affine3f transformation_centroid = Eigen::Affine3f::Identity();</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        transformation_centroid.translation()&lt;&lt;-xyz_centroid(0), -xyz_centroid(1), -xyz_centroid(2);</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="comment">//Compute PCA</span></div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        pcl::PCA&lt;PointT&gt; pca;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        pca.setInputCloud(<a class="code" href="classSuperquadricFitting.html#a62049cf3bf16b6c5c24c24d511ff989c">cloud_</a>);</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        Eigen::Vector3f eigenValues = pca.getEigenValues();</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        Eigen::Matrix3f eigenVectors = pca.getEigenVectors();</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        <span class="comment">//std::cout&lt;&lt;&quot;Eigen value from pca: &quot;&lt;&lt;eigenValues&lt;&lt;std::endl;</span></div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        <span class="comment">//Aligning first PCA axis with the prealign axis</span></div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        Eigen::Vector3f vec_aux = eigenVectors.col(0);</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        eigenVectors.col(0) = eigenVectors.col(<a class="code" href="classSuperquadricFitting.html#abbf97679b0b186ca9306d4310a799905">pre_align_axis_</a>);</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;        eigenVectors.col(<a class="code" href="classSuperquadricFitting.html#abbf97679b0b186ca9306d4310a799905">pre_align_axis_</a>) = vec_aux;</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keywordtype">float</span> aux_ev = eigenValues(0);</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        eigenValues(0) = eigenValues(<a class="code" href="classSuperquadricFitting.html#abbf97679b0b186ca9306d4310a799905">pre_align_axis_</a>);</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        eigenValues(<a class="code" href="classSuperquadricFitting.html#abbf97679b0b186ca9306d4310a799905">pre_align_axis_</a>) = aux_ev;</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        Eigen::Matrix4f transformation_pca = Eigen::Matrix4f::Identity();</div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i =0 ;i&lt;transformation_pca.cols()-1;++i)</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        {</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;          <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0;j&lt;transformation_pca.rows()-1;++j)</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;          {</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            transformation_pca(j,i) = eigenVectors(i,j);</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;          }</div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        }</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        Eigen::Affine3f transformation_pca_affine;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        transformation_pca_affine.matrix() = transformation_pca;</div><div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;        transform = transformation_pca_affine * transformation_centroid;</div><div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="comment">//transform = transformation_centroid*transformation_pca_affine ;</span></div><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div><div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="comment">//Eigen::Vector3f eigenValues;</span></div><div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        eigenValues /= <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(<a class="code" href="classSuperquadricFitting.html#a62049cf3bf16b6c5c24c24d511ff989c">cloud_</a>-&gt;size());</div><div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        variances(0) = sqrt(eigenValues(0));</div><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        variances(1) = sqrt(eigenValues(1));</div><div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        variances(2) = sqrt(eigenValues(2));</div><div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;     }</div><div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  }</div><div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <span class="comment">//By moment of intertia estimation</span></div><div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <span class="comment">/*pcl::MomentOfInertiaEstimation&lt;PointT&gt; feature_extractor;</span></div><div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">  feature_extractor.setInputCloud (cloud_);</span></div><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">  feature_extractor.compute ();</span></div><div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">  PointT  min_point_OBB;</span></div><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">  PointT  max_point_OBB;</span></div><div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">  PointT position_OBB;</span></div><div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">  PointT min_point_AABB;</span></div><div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">  PointT max_point_AABB;</span></div><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">  Eigen::Matrix3f rotational_matrix_OBB;</span></div><div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">  float major_value, middle_value, minor_value;</span></div><div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">  feature_extractor.getOBB (min_point_OBB, max_point_OBB, position_OBB, rotational_matrix_OBB);</span></div><div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">  feature_extractor.getAABB(min_point_AABB, max_point_AABB);</span></div><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">  feature_extractor.getEigenValues (major_value, middle_value, minor_value);</span></div><div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">  //Eigen::Affine3f transformation_centroid = Eigen::Affine3f::Identity();</span></div><div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">  //transformation_centroid.translation()&lt;&lt;-position_OBB.x, -position_OBB.y, -position_OBB.z;</span></div><div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">  //transformation_centroid.translation()&lt;&lt;-((min_point_AABB.x+max_point_AABB.x)/2),</span></div><div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">      //-((min_point_AABB.y+max_point_AABB.y)/2),</span></div><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">      //-((min_point_AABB.z+max_point_AABB.z)/2);</span></div><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">  Eigen::Vector3f eigenValues;</span></div><div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">  //eigenValues&lt;&lt;major_value, middle_value, minor_value;</span></div><div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment">  eigenValues&lt;&lt;0.25,0.25,0.25;</span></div><div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;<span class="comment">  //float aux_ev = eigenValues(0);</span></div><div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;<span class="comment">  //eigenValues(0) = eigenValues(pre_align_axis_);</span></div><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;<span class="comment">  //eigenValues(pre_align_axis_) = aux_ev;</span></div><div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="comment">  /*Eigen::Matrix4f transform_2 = Eigen::Matrix4f::Identity();</span></div><div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">  transform_2.block&lt;3,3&gt;(0,0) = rotational_matrix_OBB.inverse();</span></div><div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;<span class="comment"></span></div><div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;<span class="comment">  Eigen::EigenSolver&lt;Eigen::Matrix4f &gt; es(transform_2);</span></div><div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;<span class="comment">  std::cout&lt;&lt;&quot;The eigenvalue&quot;&lt;&lt;es.eigenvalues()&lt;&lt;std::endl;*/</span></div><div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div><div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;</div><div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;}</div><div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div><div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="classSuperquadricFitting.html#a2d4e611f53e1d4034594efa7638693af">  151</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="classSuperquadricFitting.html#a2d4e611f53e1d4034594efa7638693af">SuperquadricFitting::set_pose_est_method</a>(<span class="keyword">const</span> std::string method)</div><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;{</div><div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">if</span>(method == <span class="stringliteral">&quot;pca&quot;</span> || method== <span class="stringliteral">&quot;iteration&quot;</span>)</div><div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  {</div><div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <a class="code" href="classSuperquadricFitting.html#ad186d372a3169deea700462d9470fecf">pose_est_method_</a> = method;</div><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <a class="code" href="classSuperquadricFitting.html#ac119a5cf442fca0edcd613423e8e2a42">set_method_</a> = <span class="keyword">true</span>;</div><div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div><div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  }</div><div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordflow">else</span></div><div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div><div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;}</div><div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div><div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;</div><div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="classSuperquadricFitting.html#ada57c1d8c63b35a94991ab6175dac98b">  164</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classSuperquadricFitting.html#ada57c1d8c63b35a94991ab6175dac98b">SuperquadricFitting::fit_Param</a>(sq_fitting::sq&amp; param, <span class="keywordtype">double</span>&amp; final_error)</div><div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;{</div><div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  Eigen::Affine3f transform_inv;</div><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  Eigen::Vector3f variances;</div><div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;  <span class="keywordflow">if</span>(<a class="code" href="classSuperquadricFitting.html#ab77956da49f8efaf6a948ce6ea31ac1b">pre_align_</a>)</div><div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  {</div><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    <a class="code" href="classSuperquadricFitting.html#a6c217883515b40d053aff4406caaf2a1">preAlign</a>(transform_inv, variances);</div><div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <a class="code" href="classSuperquadricFitting.html#ac018436dbb2a9f98ac5c95a4d6cf7d81">prealigned_cloud_</a>.reset(<span class="keyword">new</span> pcl::PointCloud&lt;PointT&gt;);</div><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    pcl::transformPointCloud(*<a class="code" href="classSuperquadricFitting.html#a62049cf3bf16b6c5c24c24d511ff989c">cloud_</a>, *<a class="code" href="classSuperquadricFitting.html#ac018436dbb2a9f98ac5c95a4d6cf7d81">prealigned_cloud_</a>, transform_inv);</div><div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  }</div><div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div><div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  Eigen::Affine3d trans_new = (transform_inv.inverse()).cast&lt;double&gt;();</div><div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;  <span class="keywordtype">double</span> tx, ty, tz, ax, ay, az;</div><div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;  <a class="code" href="utils_8h.html#a72b13524be721ecc58959e4ed8427902">getParamFromPose</a>(trans_new, tx, ty, tz, ax, ay, az);</div><div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;</div><div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div><div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div><div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <span class="keywordtype">int</span> n_unknowns = 11;</div><div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  Eigen::VectorXd xvec(n_unknowns);</div><div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;  xvec[0] = variances(0) * 3.;</div><div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  xvec[1] = variances(1) * 3.;</div><div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  xvec[2] = variances(2) * 3.;</div><div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  xvec[3] = xvec[4] = 1.0;</div><div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  xvec[5] =  xvec[6] =  xvec[7] =  xvec[8] = xvec[9] =  xvec[10] =0.;</div><div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">/*xvec[5] = tx;</span></div><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">  xvec[6] = ty;</span></div><div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="comment">  xvec[7] = tz;</span></div><div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;<span class="comment">  xvec[8] = ax;</span></div><div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="comment">  xvec[9] = ay;</span></div><div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;<span class="comment">  xvec[10] = az;*/</span></div><div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div><div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <a class="code" href="structSuperquadricFitting_1_1OptimizationFunctor.html">OptimizationFunctor</a> functor(<a class="code" href="classSuperquadricFitting.html#ac018436dbb2a9f98ac5c95a4d6cf7d81">prealigned_cloud_</a>-&gt;size(), <span class="keyword">this</span>);</div><div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  Eigen::NumericalDiff&lt;OptimizationFunctor&gt; numericalDiffMyFunctor(functor);</div><div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  Eigen::LevenbergMarquardt&lt;Eigen::NumericalDiff&lt;OptimizationFunctor&gt;, <span class="keywordtype">double</span>&gt; lm(numericalDiffMyFunctor);</div><div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  lm.minimize(xvec);</div><div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;</div><div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  param.a1 = xvec[0];</div><div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  param.a2 = xvec[1];</div><div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  param.a3 = xvec[2];</div><div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordtype">double</span> e1 = xvec[3];</div><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordtype">double</span> e2 = xvec[4];</div><div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;  <a class="code" href="utils_8h.html#a1f0e588e989a447774a47f4c96c68a6f">sq_clampParameters</a>(e1, e2);</div><div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;  param.e1 = e1;</div><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;  param.e2 = e2;</div><div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div><div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;  Eigen::Affine3d transform_lm;</div><div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;  <span class="comment">//std::cout&lt;&lt;&quot;Transformation frm LM: &quot;&lt;&lt;xvec[5]&lt;&lt;&quot; &quot;&lt;&lt;xvec[6]&lt;&lt;&quot; &quot;&lt;&lt; xvec[7]&lt;&lt;&quot; &quot;&lt;&lt;xvec[8]&lt;&lt;&quot; &quot;&lt;&lt;xvec[9]&lt;&lt;&quot; &quot;&lt;&lt;xvec[10]&lt;&lt;std::endl;</span></div><div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;  <a class="code" href="utils_8h.html#a49e7a934da01702bfc20af93a8f42b82">create_transformation_matrix</a>(xvec[5], xvec[6], xvec[7], xvec[8], xvec[9], xvec[10], transform_lm);</div><div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div><div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;  Eigen::Affine3f transform = transform_inv.inverse();</div><div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;  Eigen::Affine3d final_transform = transform.cast&lt;<span class="keywordtype">double</span>&gt;();<span class="comment">// * transform_lm ;</span></div><div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;  <span class="comment">//Eigen::Affine3d final_transform = transform.cast&lt;double&gt;() ;</span></div><div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;  Eigen::Vector3d t = final_transform.translation();</div><div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  param.pose.position.x = t(0);</div><div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;  param.pose.position.y = t(1);</div><div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  param.pose.position.z = t(2);</div><div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  Eigen::Matrix3d rot_matrix = final_transform.rotation();</div><div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  Eigen::Quaterniond q(rot_matrix);</div><div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;  q.normalize();</div><div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;  param.pose.orientation.x = q.x();</div><div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  param.pose.orientation.y = q.y();</div><div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;  param.pose.orientation.z = q.z();</div><div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;  param.pose.orientation.w = q.w();</div><div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div><div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div><div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;  <span class="comment">//Creating a new param with pose of transform_lm to calculate error</span></div><div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;  sq_fitting::sq param_lm;</div><div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;  param_lm.a1 = param.a1;</div><div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;  param_lm.a2 = param.a2;</div><div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;  param_lm.a3 = param.a3;</div><div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;  param_lm.e1 = param.e1;</div><div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;  param_lm.e2 = param.e2;</div><div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;  Eigen::Vector3d t1 = transform_lm.translation();</div><div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;  param_lm.pose.position.x = t1(0);</div><div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;  param_lm.pose.position.y = t1(1);</div><div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  param_lm.pose.position.z = t1(2);</div><div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  Eigen::Matrix3d rot_matrix_lm = transform_lm.rotation();</div><div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;  Eigen::Quaterniond q1(rot_matrix_lm);</div><div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;  q1.normalize();</div><div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;  param_lm.pose.orientation.x = q1.x();</div><div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;  param_lm.pose.orientation.y = q1.y();</div><div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;  param_lm.pose.orientation.z = q1.z();</div><div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  param_lm.pose.orientation.w = q1.w();</div><div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  final_error = <a class="code" href="utils_8h.html#a612fbe0b48282072c3a99490f0d773a3">sq_error</a>(<a class="code" href="classSuperquadricFitting.html#a62049cf3bf16b6c5c24c24d511ff989c">cloud_</a>, param_lm);</div><div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div><div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div><div class="line"><a name="l00250"></a><span class="lineno"><a class="line" href="classSuperquadricFitting.html#aaf599def38afcab63e5bdbb1df94936a">  250</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classSuperquadricFitting.html#aaf599def38afcab63e5bdbb1df94936a">SuperquadricFitting::fit</a>()</div><div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;{</div><div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;  <span class="keywordtype">double</span> min_fit_error = std::numeric_limits&lt;double&gt;::max();</div><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;  sq_fitting::sq min_param;</div><div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;1;++i)</div><div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  {</div><div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordtype">double</span> error;</div><div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="classSuperquadricFitting.html#a05dc44535b7a27bea36c05e5a4bf4f2e">setPreAlign</a>(<span class="keyword">true</span>, i);</div><div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    sq_fitting::sq param;</div><div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="classSuperquadricFitting.html#ada57c1d8c63b35a94991ab6175dac98b">fit_Param</a>(param, error);</div><div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="comment">//std::cout&lt;&lt;&quot;Error is : &quot;&lt;&lt;error&lt;&lt;std::endl;</span></div><div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    <span class="keywordflow">if</span>(error&lt;min_fit_error)</div><div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;    {</div><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;      min_fit_error = error;</div><div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      min_param = param;</div><div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    }</div><div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;  }</div><div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="classSuperquadricFitting.html#aab1625fa8906cce96fbdcdd0850c1e07">params_</a> = min_param;</div><div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  <span class="comment">//min_error_ = min_fit_error; std::cout&lt;&lt;&quot;min error is: &quot;&lt;&lt;min_error_&lt;&lt;std::endl;</span></div><div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;}</div><div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;</div><div class="line"><a name="l00271"></a><span class="lineno"><a class="line" href="classSuperquadricFitting.html#aa43579d589f455a488019f448e288a34">  271</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classSuperquadricFitting.html#aa43579d589f455a488019f448e288a34">SuperquadricFitting::getMinError</a>(<span class="keywordtype">double</span>&amp; error)</div><div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;{</div><div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  error = <a class="code" href="classSuperquadricFitting.html#ad249e3a61ce6a2340a675e904d7de740">min_error_</a>;</div><div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;}</div><div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div><div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="structSuperquadricFitting_1_1OptimizationFunctor.html#aaf0b0eb6d34a3d5f97d4cee6f4dd638e">  276</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="structSuperquadricFitting_1_1OptimizationFunctor.html#aaf0b0eb6d34a3d5f97d4cee6f4dd638e">SuperquadricFitting::OptimizationFunctor::operator ()</a>(<span class="keyword">const</span> Eigen::VectorXd &amp;xvec, Eigen::VectorXd &amp;fvec)<span class="keyword"> const</span></div><div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;<span class="keyword"></span>{</div><div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  pcl::PointCloud&lt;PointT&gt;::Ptr cloud_new(<span class="keyword">new</span> pcl::PointCloud&lt;PointT&gt;);</div><div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  cloud_new = estimator_-&gt;prealigned_cloud_;</div><div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <span class="keywordtype">double</span> a = xvec[0], b = xvec[1],</div><div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;              c = xvec[2], e1 = xvec[3],</div><div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;              e2 =xvec[4];</div><div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;  Eigen::Affine3d trans;</div><div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;  <a class="code" href="utils_8h.html#a49e7a934da01702bfc20af93a8f42b82">create_transformation_matrix</a>(xvec[5], xvec[6], xvec[7], xvec[8], xvec[9], xvec[10], trans);</div><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;  pcl::PointCloud&lt;PointT&gt;::Ptr cloud_transformed(<span class="keyword">new</span> pcl::PointCloud&lt;PointT&gt;);</div><div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;  pcl::transformPointCloud(*cloud_new, *cloud_transformed, trans);</div><div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0;i&lt;values();++i)</div><div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;  {</div><div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    Eigen::Matrix&lt;double, 4, 1&gt; xyz_tr (cloud_transformed-&gt;at(i).x, cloud_transformed-&gt;at(i).y, cloud_transformed-&gt;at(i).z, 1.);</div><div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    <span class="keywordtype">double</span> op = Eigen::Matrix&lt;double, 3, 1&gt; (xyz_tr[0], xyz_tr[1], xyz_tr[2]).norm ();</div><div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="fitting_8h.html#af63aa02ad22799ec1b392e97942874b5">PointT</a> p;</div><div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    p.x = xyz_tr[0];</div><div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    p.y = xyz_tr[1];</div><div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    p.z = xyz_tr[2];</div><div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    fvec[i] = op * <a class="code" href="utils_8h.html#a47d6acfc4b0f320a17722f3f9476e76a">sq_function</a>(xyz_tr[0], xyz_tr[1], xyz_tr[2], a,b,c,e1,e2) ;</div><div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;  }</div><div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;  <span class="keywordflow">return</span> (0);</div><div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;}</div><div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;</div><div class="ttc" id="classSuperquadricFitting_html_aaf599def38afcab63e5bdbb1df94936a"><div class="ttname"><a href="classSuperquadricFitting.html#aaf599def38afcab63e5bdbb1df94936a">SuperquadricFitting::fit</a></div><div class="ttdeci">void fit()</div><div class="ttdoc">fit param on different preAlign axis and set minimum param and minimum error </div><div class="ttdef"><b>Definition:</b> <a href="fitting_8cpp_source.html#l00250">fitting.cpp:250</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_aa43579d589f455a488019f448e288a34"><div class="ttname"><a href="classSuperquadricFitting.html#aa43579d589f455a488019f448e288a34">SuperquadricFitting::getMinError</a></div><div class="ttdeci">void getMinError(double &amp;error)</div><div class="ttdoc">obtain minimum error </div><div class="ttdef"><b>Definition:</b> <a href="fitting_8cpp_source.html#l00271">fitting.cpp:271</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_ada57c1d8c63b35a94991ab6175dac98b"><div class="ttname"><a href="classSuperquadricFitting.html#ada57c1d8c63b35a94991ab6175dac98b">SuperquadricFitting::fit_Param</a></div><div class="ttdeci">void fit_Param(sq_fitting::sq &amp;param, double &amp;final_error)</div><div class="ttdoc">fit params on current preAlign axis and return the minimum param and error </div><div class="ttdef"><b>Definition:</b> <a href="fitting_8cpp_source.html#l00164">fitting.cpp:164</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_ab77956da49f8efaf6a948ce6ea31ac1b"><div class="ttname"><a href="classSuperquadricFitting.html#ab77956da49f8efaf6a948ce6ea31ac1b">SuperquadricFitting::pre_align_</a></div><div class="ttdeci">bool pre_align_</div><div class="ttdef"><b>Definition:</b> <a href="fitting_8h_source.html#l00097">fitting.h:97</a></div></div>
<div class="ttc" id="utils_8h_html_a1f0e588e989a447774a47f4c96c68a6f"><div class="ttname"><a href="utils_8h.html#a1f0e588e989a447774a47f4c96c68a6f">sq_clampParameters</a></div><div class="ttdeci">void sq_clampParameters(double &amp;e1_clamped, double &amp;e2_clamped)</div><div class="ttdef"><b>Definition:</b> <a href="utils_8cpp_source.html#l00010">utils.cpp:10</a></div></div>
<div class="ttc" id="utils_8h_html_a612fbe0b48282072c3a99490f0d773a3"><div class="ttname"><a href="utils_8h.html#a612fbe0b48282072c3a99490f0d773a3">sq_error</a></div><div class="ttdeci">double sq_error(const pcl::PointCloud&lt; PointT &gt;::Ptr cloud, const sq_fitting::sq &amp;param)</div><div class="ttdef"><b>Definition:</b> <a href="utils_8cpp_source.html#l00065">utils.cpp:65</a></div></div>
<div class="ttc" id="structSuperquadricFitting_1_1OptimizationFunctor_html_aaf0b0eb6d34a3d5f97d4cee6f4dd638e"><div class="ttname"><a href="structSuperquadricFitting_1_1OptimizationFunctor.html#aaf0b0eb6d34a3d5f97d4cee6f4dd638e">SuperquadricFitting::OptimizationFunctor::operator()</a></div><div class="ttdeci">int operator()(const Eigen::VectorXd &amp;xvec, Eigen::VectorXd &amp;fvec) const </div><div class="ttdef"><b>Definition:</b> <a href="fitting_8cpp_source.html#l00276">fitting.cpp:276</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_ac59690650a3dcc82611252df47515124"><div class="ttname"><a href="classSuperquadricFitting.html#ac59690650a3dcc82611252df47515124">SuperquadricFitting::SuperquadricFitting</a></div><div class="ttdeci">SuperquadricFitting(const SuperquadricFitting &amp;src)</div><div class="ttdoc">Copy Constructor. </div><div class="ttdef"><b>Definition:</b> <a href="fitting_8h_source.html#l00024">fitting.h:24</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_ad186d372a3169deea700462d9470fecf"><div class="ttname"><a href="classSuperquadricFitting.html#ad186d372a3169deea700462d9470fecf">SuperquadricFitting::pose_est_method_</a></div><div class="ttdeci">std::string pose_est_method_</div><div class="ttdef"><b>Definition:</b> <a href="fitting_8h_source.html#l00100">fitting.h:100</a></div></div>
<div class="ttc" id="utils_8h_html_a49e7a934da01702bfc20af93a8f42b82"><div class="ttname"><a href="utils_8h.html#a49e7a934da01702bfc20af93a8f42b82">create_transformation_matrix</a></div><div class="ttdeci">void create_transformation_matrix(const double tx, const double ty, const double tz, const double ax, const double ay, const double az, Eigen::Affine3d &amp;trns_mat)</div><div class="ttdef"><b>Definition:</b> <a href="utils_8cpp_source.html#l00106">utils.cpp:106</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_a2d4e611f53e1d4034594efa7638693af"><div class="ttname"><a href="classSuperquadricFitting.html#a2d4e611f53e1d4034594efa7638693af">SuperquadricFitting::set_pose_est_method</a></div><div class="ttdeci">bool set_pose_est_method(const std::string method)</div><div class="ttdoc">setting pose estimation method </div><div class="ttdef"><b>Definition:</b> <a href="fitting_8cpp_source.html#l00151">fitting.cpp:151</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_abbf97679b0b186ca9306d4310a799905"><div class="ttname"><a href="classSuperquadricFitting.html#abbf97679b0b186ca9306d4310a799905">SuperquadricFitting::pre_align_axis_</a></div><div class="ttdeci">int pre_align_axis_</div><div class="ttdef"><b>Definition:</b> <a href="fitting_8h_source.html#l00098">fitting.h:98</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_a3a0199ef93abec4e871a076d4e715f09"><div class="ttname"><a href="classSuperquadricFitting.html#a3a0199ef93abec4e871a076d4e715f09">SuperquadricFitting::getMinParams</a></div><div class="ttdeci">void getMinParams(sq_fitting::sq &amp;param)</div><div class="ttdoc">obtain minimum params </div><div class="ttdef"><b>Definition:</b> <a href="fitting_8cpp_source.html#l00022">fitting.cpp:22</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_a18e5c50bfe3d9f4c439574f5c63de4b5"><div class="ttname"><a href="classSuperquadricFitting.html#a18e5c50bfe3d9f4c439574f5c63de4b5">SuperquadricFitting::getPreAlignedCloud</a></div><div class="ttdeci">void getPreAlignedCloud(pcl::PointCloud&lt; PointT &gt;::Ptr &amp;cloud)</div><div class="ttdoc">obtain the pre aligned cloud </div><div class="ttdef"><b>Definition:</b> <a href="fitting_8cpp_source.html#l00027">fitting.cpp:27</a></div></div>
<div class="ttc" id="utils_8h_html_a72b13524be721ecc58959e4ed8427902"><div class="ttname"><a href="utils_8h.html#a72b13524be721ecc58959e4ed8427902">getParamFromPose</a></div><div class="ttdeci">void getParamFromPose(const geometry_msgs::Pose &amp;pose, double &amp;tx, double &amp;ty, double &amp;tz, double &amp;ax, double &amp;ay, double &amp;az)</div><div class="ttdef"><b>Definition:</b> <a href="utils_8cpp_source.html#l00123">utils.cpp:123</a></div></div>
<div class="ttc" id="structSuperquadricFitting_1_1OptimizationFunctor_html"><div class="ttname"><a href="structSuperquadricFitting_1_1OptimizationFunctor.html">SuperquadricFitting::OptimizationFunctor</a></div><div class="ttdef"><b>Definition:</b> <a href="fitting_8h_source.html#l00124">fitting.h:124</a></div></div>
<div class="ttc" id="fitting_8h_html"><div class="ttname"><a href="fitting_8h.html">fitting.h</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_ac119a5cf442fca0edcd613423e8e2a42"><div class="ttname"><a href="classSuperquadricFitting.html#ac119a5cf442fca0edcd613423e8e2a42">SuperquadricFitting::set_method_</a></div><div class="ttdeci">bool set_method_</div><div class="ttdef"><b>Definition:</b> <a href="fitting_8h_source.html#l00101">fitting.h:101</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_a6c217883515b40d053aff4406caaf2a1"><div class="ttname"><a href="classSuperquadricFitting.html#a6c217883515b40d053aff4406caaf2a1">SuperquadricFitting::preAlign</a></div><div class="ttdeci">void preAlign(Eigen::Affine3f &amp;transform, Eigen::Vector3f &amp;variances)</div><div class="ttdoc">set preAlign and get transform and variances </div><div class="ttdef"><b>Definition:</b> <a href="fitting_8cpp_source.html#l00038">fitting.cpp:38</a></div></div>
<div class="ttc" id="utils_8h_html_a47d6acfc4b0f320a17722f3f9476e76a"><div class="ttname"><a href="utils_8h.html#a47d6acfc4b0f320a17722f3f9476e76a">sq_function</a></div><div class="ttdeci">double sq_function(const PointT &amp;point, const sq_fitting::sq &amp;param)</div><div class="ttdef"><b>Definition:</b> <a href="utils_8cpp_source.html#l00023">utils.cpp:23</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_a62049cf3bf16b6c5c24c24d511ff989c"><div class="ttname"><a href="classSuperquadricFitting.html#a62049cf3bf16b6c5c24c24d511ff989c">SuperquadricFitting::cloud_</a></div><div class="ttdeci">pcl::PointCloud&lt; PointT &gt;::Ptr cloud_</div><div class="ttdef"><b>Definition:</b> <a href="fitting_8h_source.html#l00094">fitting.h:94</a></div></div>
<div class="ttc" id="utils_8h_html_ad778895dd75a8d0566e4dc38eec2f317"><div class="ttname"><a href="utils_8h.html#ad778895dd75a8d0566e4dc38eec2f317">getTransformPose</a></div><div class="ttdeci">void getTransformPose(pcl::PointCloud&lt; PointT &gt;::Ptr &amp;cloud_in, geometry_msgs::Pose &amp;pose)</div><div class="ttdef"><b>Definition:</b> <a href="utils_8cpp_source.html#l00196">utils.cpp:196</a></div></div>
<div class="ttc" id="fitting_8h_html_af63aa02ad22799ec1b392e97942874b5"><div class="ttname"><a href="fitting_8h.html#af63aa02ad22799ec1b392e97942874b5">PointT</a></div><div class="ttdeci">pcl::PointXYZRGB PointT</div><div class="ttdef"><b>Definition:</b> <a href="fitting_8h_source.html#l00012">fitting.h:12</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_a05dc44535b7a27bea36c05e5a4bf4f2e"><div class="ttname"><a href="classSuperquadricFitting.html#a05dc44535b7a27bea36c05e5a4bf4f2e">SuperquadricFitting::setPreAlign</a></div><div class="ttdeci">void setPreAlign(bool pre_align, int pre_align_axis=2)</div><div class="ttdoc">setting pre align axis </div><div class="ttdef"><b>Definition:</b> <a href="fitting_8cpp_source.html#l00032">fitting.cpp:32</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_ac018436dbb2a9f98ac5c95a4d6cf7d81"><div class="ttname"><a href="classSuperquadricFitting.html#ac018436dbb2a9f98ac5c95a4d6cf7d81">SuperquadricFitting::prealigned_cloud_</a></div><div class="ttdeci">pcl::PointCloud&lt; PointT &gt;::Ptr prealigned_cloud_</div><div class="ttdef"><b>Definition:</b> <a href="fitting_8h_source.html#l00095">fitting.h:95</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_aab1625fa8906cce96fbdcdd0850c1e07"><div class="ttname"><a href="classSuperquadricFitting.html#aab1625fa8906cce96fbdcdd0850c1e07">SuperquadricFitting::params_</a></div><div class="ttdeci">sq_fitting::sq params_</div><div class="ttdef"><b>Definition:</b> <a href="fitting_8h_source.html#l00096">fitting.h:96</a></div></div>
<div class="ttc" id="classSuperquadricFitting_html_ad249e3a61ce6a2340a675e904d7de740"><div class="ttname"><a href="classSuperquadricFitting.html#ad249e3a61ce6a2340a675e904d7de740">SuperquadricFitting::min_error_</a></div><div class="ttdeci">double min_error_</div><div class="ttdef"><b>Definition:</b> <a href="fitting_8h_source.html#l00099">fitting.h:99</a></div></div>
<div class="ttc" id="utils_8h_html_aaac31e71435e34a72d1fcdeb1dfc4788"><div class="ttname"><a href="utils_8h.html#aaac31e71435e34a72d1fcdeb1dfc4788">getCenter</a></div><div class="ttdeci">void getCenter(pcl::PointCloud&lt; PointT &gt;::Ptr &amp;cloud_in, double &amp;x, double &amp;y, double &amp;z)</div><div class="ttdef"><b>Definition:</b> <a href="utils_8cpp_source.html#l00168">utils.cpp:168</a></div></div>
</div><!-- fragment --></div><!-- contents -->

<br clear="all" />
<hr size="1"><div style="align: right;">
<a href="http://wiki.ros.org/sq_fitting">sq_fitting</a><br />
Author(s): </br />
<small>autogenerated on Mon Mar 5 2018 23:33:56</small>
</div>
</body>
</html>
